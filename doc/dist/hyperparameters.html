<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>dist.hyperparameters API documentation</title>
<meta name="description" content="Provides class to search for the best hyperparameters of a clustering algorithm …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>dist.hyperparameters</code></h1>
</header>
<section id="section-intro">
<p>Provides class to search for the best hyperparameters of a clustering algorithm</p>
<p>Currently only supports the search for alpha, beta, gamme hyperarameters.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Provides class to search for the best hyperparameters of a clustering algorithm

Currently only supports the search for alpha, beta, gamme hyperarameters.
&#34;&#34;&#34;
from typing import *
import optuna
from optuna_dashboard.preferential import create_study, PreferentialStudy
from optuna_dashboard.preferential.samplers.gp import PreferentialGPSampler
from optuna.artifacts import FileSystemArtifactStore
from optuna_dashboard import save_note


class SearchClustering:
    &#34;&#34;&#34;Allow to search for the best alpha, beta, gamma parameters for the pipeline

    # Arguments
    - study_name: str, the name of the study where to store the preference of the user and the optimization result
    - fn: Callable[[List[str], Tuple[float, float, float], Tuple[float, float, float]], Tuple[int, str, str]], a function that takes the logs to cluster, two tuples of alpha, beta, gamme, make the clustering, print the result and ask the user to choose the best possibility (0 or 1)
    
    &#34;&#34;&#34;

    def __init__(self, study_name: str, fn: Callable[[List[str], Tuple[float, float, float], Tuple[float, float, float]], Tuple[int, str, str]]) -&gt; None:
        self.study_name = f&#34;study-{study_name}&#34;  # Unique identifier of the study.
        storage_name = &#34;sqlite:///{}.db&#34;.format(study_name)
        sampler = optuna.samplers.TPESampler(seed=0)
        storage = optuna.storages.RDBStorage(
            storage_name, engine_kwargs={&#34;connect_args&#34;: {&#34;timeout&#34;: 20.0}}
        )
        self.study = create_study(
            study_name=study_name,
            storage=storage,
            load_if_exists=True,
            sampler=sampler,
            n_generate=2,
        )
        self.artifact_store = FileSystemArtifactStore(
            base_path=study_name + &#34;.artifact&#34;
        )
        self.fn = fn
        super().__init__()

    def ask_best_clustering(
        self,
        logs: List[str],
    ):
        &#34;&#34;&#34;Ask the user for a feedback between two clusterings. The two clusterings are generated and shown by fn
        
        # Arguments
        - logs: List[str], list of texts for each line
        &#34;&#34;&#34;
        trials = []
        for _ in range(2):
            trial = self.study.ask()
            alpha = trial.suggest_float(&#34;alpha&#34;, 0, 1)
            beta = trial.suggest_float(&#34;beta&#34;, 0, 1 - alpha)
            gamma = 1 - (alpha + beta)
            trials.append({&#34;params&#34;: (alpha, beta, gamma), &#34;trial&#34;: trial})

        preference, clustering0, clustering1 = self.fn(
            logs, trials[0][&#34;params&#34;], trials[1][&#34;params&#34;]
        )
        save_note(trials[0][&#39;trial&#39;], clustering0)
        save_note(trials[1][&#39;trial&#39;], clustering1)
        self.study.report_preference(
            better_trials=trials[preference][&#34;trial&#34;],
            worse_trials=trials[1 - preference][&#34;trial&#34;],
        )


def test_fn(
    logs: List[str], coef1: Tuple[float, float, float], coef2: Tuple[float, float, float]
) -&gt; Tuple[int, str, str]:
    &#34;&#34;&#34;Demo function on how to do suggestions&#34;&#34;&#34;
    import pretty_print as pp
    import random

    L: List[str] = []
    for _ in range(2):
        clustering = {i: random.randint(0, 3) for i in range(len(logs))}
        colored_clustering = pp.convert_clustering_to_colored_clustering(
            logs, clustering
        )
        html = pp.generate_clustering_markdown_html(colored_clustering)
        pp.print_colored_clustering_rich(colored_clustering)
        print(&#34;-&#34;*100)
        L.append(html)
    p = int(input(&#34;Which coef seem better to you?&#34;))
    return p, L[0], L[1]


if __name__ == &#34;__main__&#34;:
    import lorem_text.lorem as lt
    s = SearchClustering(&#34;tmp&#34;,test_fn)
    logs = [lt.sentence() for _ in range(10)]
    s.ask_best_clustering(logs)
    s.ask_best_clustering(logs)
    s.ask_best_clustering(logs)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="dist.hyperparameters.test_fn"><code class="name flex">
<span>def <span class="ident">test_fn</span></span>(<span>logs: List[str], coef1: Tuple[float, float, float], coef2: Tuple[float, float, float]) ‑> Tuple[int, str, str]</span>
</code></dt>
<dd>
<div class="desc"><p>Demo function on how to do suggestions</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_fn(
    logs: List[str], coef1: Tuple[float, float, float], coef2: Tuple[float, float, float]
) -&gt; Tuple[int, str, str]:
    &#34;&#34;&#34;Demo function on how to do suggestions&#34;&#34;&#34;
    import pretty_print as pp
    import random

    L: List[str] = []
    for _ in range(2):
        clustering = {i: random.randint(0, 3) for i in range(len(logs))}
        colored_clustering = pp.convert_clustering_to_colored_clustering(
            logs, clustering
        )
        html = pp.generate_clustering_markdown_html(colored_clustering)
        pp.print_colored_clustering_rich(colored_clustering)
        print(&#34;-&#34;*100)
        L.append(html)
    p = int(input(&#34;Which coef seem better to you?&#34;))
    return p, L[0], L[1]</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="dist.hyperparameters.SearchClustering"><code class="flex name class">
<span>class <span class="ident">SearchClustering</span></span>
<span>(</span><span>study_name: str, fn: Callable[[List[str], Tuple[float, float, float], Tuple[float, float, float]], Tuple[int, str, str]])</span>
</code></dt>
<dd>
<div class="desc"><p>Allow to search for the best alpha, beta, gamma parameters for the pipeline</p>
<h1 id="arguments">Arguments</h1>
<ul>
<li>study_name: str, the name of the study where to store the preference of the user and the optimization result</li>
<li>fn: Callable[[List[str], Tuple[float, float, float], Tuple[float, float, float]], Tuple[int, str, str]], a function that takes the logs to cluster, two tuples of alpha, beta, gamme, make the clustering, print the result and ask the user to choose the best possibility (0 or 1)</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SearchClustering:
    &#34;&#34;&#34;Allow to search for the best alpha, beta, gamma parameters for the pipeline

    # Arguments
    - study_name: str, the name of the study where to store the preference of the user and the optimization result
    - fn: Callable[[List[str], Tuple[float, float, float], Tuple[float, float, float]], Tuple[int, str, str]], a function that takes the logs to cluster, two tuples of alpha, beta, gamme, make the clustering, print the result and ask the user to choose the best possibility (0 or 1)
    
    &#34;&#34;&#34;

    def __init__(self, study_name: str, fn: Callable[[List[str], Tuple[float, float, float], Tuple[float, float, float]], Tuple[int, str, str]]) -&gt; None:
        self.study_name = f&#34;study-{study_name}&#34;  # Unique identifier of the study.
        storage_name = &#34;sqlite:///{}.db&#34;.format(study_name)
        sampler = optuna.samplers.TPESampler(seed=0)
        storage = optuna.storages.RDBStorage(
            storage_name, engine_kwargs={&#34;connect_args&#34;: {&#34;timeout&#34;: 20.0}}
        )
        self.study = create_study(
            study_name=study_name,
            storage=storage,
            load_if_exists=True,
            sampler=sampler,
            n_generate=2,
        )
        self.artifact_store = FileSystemArtifactStore(
            base_path=study_name + &#34;.artifact&#34;
        )
        self.fn = fn
        super().__init__()

    def ask_best_clustering(
        self,
        logs: List[str],
    ):
        &#34;&#34;&#34;Ask the user for a feedback between two clusterings. The two clusterings are generated and shown by fn
        
        # Arguments
        - logs: List[str], list of texts for each line
        &#34;&#34;&#34;
        trials = []
        for _ in range(2):
            trial = self.study.ask()
            alpha = trial.suggest_float(&#34;alpha&#34;, 0, 1)
            beta = trial.suggest_float(&#34;beta&#34;, 0, 1 - alpha)
            gamma = 1 - (alpha + beta)
            trials.append({&#34;params&#34;: (alpha, beta, gamma), &#34;trial&#34;: trial})

        preference, clustering0, clustering1 = self.fn(
            logs, trials[0][&#34;params&#34;], trials[1][&#34;params&#34;]
        )
        save_note(trials[0][&#39;trial&#39;], clustering0)
        save_note(trials[1][&#39;trial&#39;], clustering1)
        self.study.report_preference(
            better_trials=trials[preference][&#34;trial&#34;],
            worse_trials=trials[1 - preference][&#34;trial&#34;],
        )</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="dist.hyperparameters.SearchClustering.ask_best_clustering"><code class="name flex">
<span>def <span class="ident">ask_best_clustering</span></span>(<span>self, logs: List[str])</span>
</code></dt>
<dd>
<div class="desc"><p>Ask the user for a feedback between two clusterings. The two clusterings are generated and shown by fn</p>
<h1 id="arguments">Arguments</h1>
<ul>
<li>logs: List[str], list of texts for each line</li>
</ul></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def ask_best_clustering(
    self,
    logs: List[str],
):
    &#34;&#34;&#34;Ask the user for a feedback between two clusterings. The two clusterings are generated and shown by fn
    
    # Arguments
    - logs: List[str], list of texts for each line
    &#34;&#34;&#34;
    trials = []
    for _ in range(2):
        trial = self.study.ask()
        alpha = trial.suggest_float(&#34;alpha&#34;, 0, 1)
        beta = trial.suggest_float(&#34;beta&#34;, 0, 1 - alpha)
        gamma = 1 - (alpha + beta)
        trials.append({&#34;params&#34;: (alpha, beta, gamma), &#34;trial&#34;: trial})

    preference, clustering0, clustering1 = self.fn(
        logs, trials[0][&#34;params&#34;], trials[1][&#34;params&#34;]
    )
    save_note(trials[0][&#39;trial&#39;], clustering0)
    save_note(trials[1][&#39;trial&#39;], clustering1)
    self.study.report_preference(
        better_trials=trials[preference][&#34;trial&#34;],
        worse_trials=trials[1 - preference][&#34;trial&#34;],
    )</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="dist" href="index.html">dist</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="dist.hyperparameters.test_fn" href="#dist.hyperparameters.test_fn">test_fn</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="dist.hyperparameters.SearchClustering" href="#dist.hyperparameters.SearchClustering">SearchClustering</a></code></h4>
<ul class="">
<li><code><a title="dist.hyperparameters.SearchClustering.ask_best_clustering" href="#dist.hyperparameters.SearchClustering.ask_best_clustering">ask_best_clustering</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>